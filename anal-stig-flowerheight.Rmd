---
title: "Effects of flower height on stigmatic pollen load"
author: "Claire Smith"
date: "2023-06-19"
output: github_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r initialize, message=F}
# Load packages
library(tidyverse)
library(lme4) # for linear mixed effects models
library(lmerTest)
# Source files
source("clean-stig-01.R")
source("clean-stig-02.R")
source("theme_cs.R")
# Load data
stig <- read.csv("processed-data/stig-no-rep-spp.csv", stringsAsFactors = T)
```

```{r pre-processing data}
# Take only entries with flower height data and pollen load data
stigfh <- stig %>% 
  filter(!is.na(Flower_height)&!is.na(Flw_pollen))
# head(stigfh)
# summary(stigfh)

# How many species have flower height data? 
# unique(stigfh$Species) # 8 species
# [1] Ambrosia artemisiifolia     Amaranthus retroflexus      Dichanthelium linearifolium Dichanthelium implicatum  
# [5] Phleum pratense             Setaria viridis             Rumex acetosella 
# Plantago major
# View(stigfh)

# Flower is nested within plant - each plant has (potentially) multiple flowers measured within it -- need to 
# create a unique plant ID for each plant within a species
stigfh$Ind_ID=paste(stigfh$Date, stigfh$Site, stigfh$Plant, sep = "-")
#How many unique individuals per species? 
stigfh %>% group_by(Species) %>%
  distinct(Ind_ID) %>% 
  summarize(n=n())
# Species                         n
# <fct>                       <int>
# 1 Amaranthus retroflexus         30
# 2 Ambrosia artemisiifolia        30
# 3 Dichanthelium implicatum       40
# 4 Dichanthelium linearifolium    13
# 5 Phleum pratense                18
# 6 Plantago major                 15
# 7 Rumex acetosella               50
# 8 Setaria viridis                45
# Will exclude Dichanthelium linearifolium from this because it only has 13 entries. 

# I'll go through each species and run a model predicting pollen capture by flower height
# Since many likely have log-normal distributions of pollen capture, I'll create a log flw pollen variable now to # save time -- but will still check each species individually 
stigfh$Log_flw_pollen <- log(stigfh$Flw_pollen+1)
```

### Amaranthus retroflexus (n=30)

```{r pre-fit Amaranthus retroflexus}
AMRE <- stigfh %>% 
  filter(Species=="Amaranthus retroflexus")
# summary(AMRE) # 2 sites, FBF and FBF2

#Taking a look at the data
hist(AMRE$Flw_pollen) # response variable. looks very right skewed!
hist(AMRE$Log_flw_pollen) # much more symmetric
hist(AMRE$Flower_height) # looks a little right-skewed
hist(log(AMRE$Flower_height+1)) # now a little left-skewed... I'll just use raw flower height

# Look at plot of Log_flw_pollen and Flw_height 
# looks like no big difference between sites in how much pollen they receive wrt height
plot(AMRE$Flower_height, AMRE$Log_flw_pollen, col=as.factor(AMRE$Site))
```

```{r flower height vs pollen load Amaranthus retroflexus}
# Look at plot of Log_flw_pollen and Flw_height 
# Looks like no big differences between sites in flower height or pollen load
ggplot(data=AMRE, aes(x=Flower_height, y=Log_flw_pollen, color=Date, shape=Site)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Amaranthus retroflexus}
#model for height
# AMREmod <- lmer(Log_flw_pollen ~ poly(Flower_height, 2) + Site + (1|Ind_ID), data=AMRE)
# no sig quadratic term
AMREmod <- lmer(Log_flw_pollen ~ Flower_height + Site + (1|Ind_ID), data=AMRE)
summary(AMREmod)
anova(AMREmod)
# No significant effect of flower height or site on pollen loads in Amaranthus retroflexus. 

```

### Ambrosia artemisiifolia (n=30)

```{r pre-fit Ambrosia artemisiifolia}
AMAR <- stigfh %>% 
  filter(Species=="Ambrosia artemisiifolia")
summary(AMAR) # 2 sites, FBF and LP

#Taking a look at the data
hist(AMAR$Flw_pollen) # response variable. looks very right skewed!
hist(AMAR$Log_flw_pollen) # much more symmetric
hist(AMAR$Flower_height) # looks ok
```

```{r flower height vs pollen load Ambrosia artemisiifolia}
# Look at plot of Log_flw_pollen and Flw_height 
# Seems like FBF received more pollen overall and was shorter. Collected a few days 
# earlier than LP - maybe plays a role? 
ggplot(data=AMAR, aes(x=Flower_height, y=Log_flw_pollen, color=Date, shape=Site)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Ambrosia artemisiifolia}
#model for height
# AMARmod <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + Site + (1|Ind_ID), data=AMAR)
# no sig quadratic term
AMARmod <- lmer(Log_flw_pollen ~ Flower_height + Site + (1|Ind_ID), data=AMAR)
summary(AMARmod)
anova(AMARmod)
# anova(AMARmod2)
# anova(AMARmod, AMARmod2) # no sig difference between models
```

Site has a significant effect on pollen load, but not flower height, in Ambrosia artemisiifolia. No significant interaction of site and flower height. No difference in explanatory power between model with site x flower height interaction vs without. 

```{r Ambrosia artemisiifolia site effects}
ggplot(data=AMAR, aes(x=Site, y=Log_flw_pollen, fill=Date)) + 
  geom_violin() + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
# FBF was taken on Sep 14 2021, LP was taken on Sep 20 2021 - may also be an effect of date on pollen capture.
# View(AMAR)
```

### Dichanthelium implicatum (n=40)

```{r pre-fit Dichanthelium implicatum}
DIIM <- stigfh %>% 
  filter(Species=="Dichanthelium implicatum")
# summary(DIIM) # 2 sites, KME and KMW, tho 3x the entries in KME than KMW

#Taking a look at the data
hist(DIIM$Flw_pollen) # response variable. looks very right skewed!
hist(DIIM$Log_flw_pollen) # much more symmetric
hist(DIIM$Flower_height) # looks ok
```

```{r flower height vs pollen load Dichanthelium implicatum}
# Look at plot of Log_flw_pollen and Flw_height 
# Much fewer points from KMW than KME, but they seemed to have received more pollen and were taller and less variable in height than KMW plants
ggplot(data=DIIM, aes(x=Flower_height, y=Log_flw_pollen, color=Date, shape=Site)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Dichanthelium implicatum}
#model for height and site
# DIIMmod <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + Site + (1|Ind_ID), data=DIIM)
# summary(DIIMmod)
# anova(DIIMmod) # quad term not sig, site sig
# DIIMmod2 <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + Date + (1|Ind_ID), data=DIIM)
# summary(DIIMmod2)
# anova(DIIMmod2) # quad term not sig, date sig
DIIMmod3 <- lmer(Log_flw_pollen ~ Flower_height + Site + (1|Ind_ID), data=DIIM)
summary(DIIMmod3)
anova(DIIMmod3) # flower height not sig, site sig
DIIMmod4 <- lmer(Log_flw_pollen ~ Flower_height + Date + (1|Ind_ID), data=DIIM)
summary(DIIMmod4)
anova(DIIMmod4) # flower height not sig, date sig

# No significant quadratic or linear effect of flower height. Date and site both significant. 
```

```{r Dichanthelium implicatum site and date effects}
ggplot(data=DIIM, aes(x=Date, y=Log_flw_pollen, fill=Site)) + 
  geom_violin() + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

### Phleum pratense (n=18)

```{r pre-fit Phleum pratense}
PHPR <- stigfh %>% 
  filter(Species=="Phleum pratense")
# summary(PHPR) # 1 site, 1 date

#Taking a look at the data
hist(PHPR$Flw_pollen) # response variable. looks very right skewed!
hist(PHPR$Log_flw_pollen) # much more symmetric
hist(PHPR$Flower_height) # looks ok
```

```{r flower height vs pollen load Phleum pratense}
# Look at plot of Log_flw_pollen and Flw_height 
# Much fewer points from KMW than KME, but they seemed to have received more pollen and were taller and less variable in height than KMW plants
ggplot(data=PHPR, aes(x=Flower_height, y=Log_flw_pollen)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Phleum pratense}
#model for height and site
# PHPRmod <- lmer(Log_flw_pollen ~ poly(Flower_height, 2) + (1|Ind_ID), data=PHPR)
# # quad term not sig
PHPRmod <- lmer(Log_flw_pollen ~ Flower_height + (1|Ind_ID), data=PHPR)
summary(PHPRmod)
anova(PHPRmod) # no sig effect of flower height
```

### Plantago major (n=15)

```{r pre-fit Plantago major}
PLMA <- stigfh %>% 
  filter(Species=="Plantago major")
# summary(PLMA) # 1 site, 1 date

#Taking a look at the data
hist(PLMA$Flw_pollen) # response variable. looks very right skewed!
hist(PLMA$Log_flw_pollen) # much more symmetric
hist(PLMA$Flower_height) # looks ok
```

```{r flower height vs pollen load Plantago major}
# Look at plot of Log_flw_pollen and Flw_height 
# Much fewer points from KMW than KME, but they seemed to have received more pollen and were taller and less variable in height than KMW plants
ggplot(data=PLMA, aes(x=Flower_height, y=Log_flw_pollen)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Plantago major}
#model for height and site
# PLMAmod <- lmer(Log_flw_pollen ~ poly(Flower_height, 2) + (1|Ind_ID), data=PLMA)
# # quad term not sig
PLMAmod <- lmer(Log_flw_pollen ~ Flower_height + (1|Ind_ID), data=PLMA)
summary(PLMAmod)
anova(PLMAmod) # no sig effect of flower height
```


### Rumex acetosella (n=50)

```{r pre-fit Rumex acetosella}
RUAC <- stigfh %>% 
  filter(Species=="Rumex acetosella")
# summary(RUAC) # 3 sites, 4 dates from June 4 to 9 2021
# View(RUAC)

#Taking a look at the data
hist(RUAC$Flw_pollen) # response variable. looks very right skewed!
hist(RUAC$Log_flw_pollen) # better
hist(RUAC$Flower_height) # looks ok
```

```{r flower height vs pollen load Rumex acetosella}
# Look at plot of Log_flw_pollen and Flw_height 
# overall doesn't seem to be much of a trend of flower height and pollen load
ggplot(data=RUAC, aes(x=Flower_height, y=Log_flw_pollen, color=Date, shape=Site)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Rumex acetosella}
# #model for height and site
# RUACmod <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + Site + (1|Ind_ID), data=RUAC)
# summary(RUACmod)
# anova(RUACmod) # quad term not sig, site not sig
# RUACmod2 <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + Date + (1|Ind_ID), data=RUAC)
# summary(RUACmod2)
# anova(RUACmod2) # quad term not sig, date not sig
RUACmod3 <- lmer(Log_flw_pollen ~ Flower_height + Site + (1|Ind_ID), data=RUAC)
summary(RUACmod3)
anova(RUACmod3) # flower height not sig, site not sig
RUACmod4 <- lmer(Log_flw_pollen ~ Flower_height + Date + (1|Ind_ID), data=RUAC)
summary(RUACmod4)
anova(RUACmod4) # flower height not sig, date not sig

# No significant quadratic or linear effect of flower height. No effect of date or site.
```

```{r Rumex acetosella site and date effects}
ggplot(data=RUAC, aes(x=Date, y=Log_flw_pollen, fill=Site)) + 
  geom_violin() + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

### Setaria viridis (n=45)

```{r pre-fit Setaria viridis}
SEVI <- stigfh %>% 
  filter(Species=="Setaria viridis")
# summary(SEVI) # 1 site, 1 date
# View(SEVI)

#Taking a look at the data
hist(SEVI$Flw_pollen) # response variable. looks very right skewed!
hist(SEVI$Log_flw_pollen) # better
hist(SEVI$Flower_height) # looks ok
```

```{r flower height vs pollen load Setaria viridis}
# Look at plot of Log_flw_pollen and Flw_height 
# overall doesn't seem to be much of a trend of flower height and pollen load
ggplot(data=SEVI, aes(x=Flower_height, y=Log_flw_pollen, color=Date, shape=Site)) + 
  geom_point(size=3) + 
  scale_x_continuous(name="Flower height") + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

```{r model fit Setaria viridis}
# SEVImod <- lmer(Log_flw_pollen ~ poly(Flower_height,2) + (1|Ind_ID), data=SEVI)
# summary(SEVImod)
# anova(SEVImod) # quad term not sig
SEVImod <- lmer(Log_flw_pollen ~ Flower_height + (1|Ind_ID), data=SEVI)
summary(SEVImod)
anova(SEVImod) # flower height not sig

# No significant quadratic or linear effect of flower height. 
```

```{r Setaria viridis site and date effects}
ggplot(data=SEVI, aes(x=Date, y=Log_flw_pollen, fill=Site)) + 
  geom_violin() + 
  scale_y_continuous(name="Log stigmatic pollen load") + 
  theme_cs()
```

